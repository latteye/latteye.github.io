<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> wav、flac 转换 MP3 脚本 · Water is</title><meta name="description" content="wav、flac 转换 MP3 脚本 - latteye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://latteye.me/atom.xml" title="Water is"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/yuan-hao-yang" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">wav、flac 转换 MP3 脚本</h1><div class="post-info">2007年11月2日</div><div class="post-content"><p>在一个讨论音乐的论坛上找到了这个脚本，写的很不错。解决了 CUE 信息输入 MP3 的问题。因为他 lame 的处理并没有放在 shntool 里面。<br>由于单引号的屏蔽， shntool 里面无法将 mp3 tag 输入文件中。此脚本将所有信息全部放在变量里面，再输入。</p>
<p>该脚本除了之前提到的 shntool 以外还用到了 cueprint 工具包。你可以通过以下命令安装：</p>
<p>原模板用在最新的 shntool 上有一点错误，我稍许修改了一下。</p>
<p><code>apt-get install cuetools</code></p>
<a id="more"></a>
<p>`</p>
<p>#!/bin/bash<br>echo “Brian’s Archive CUE/FLAC Splitter v0.1”<br>echo “No sanity checking in place. Be careful.”`</p>
<p>#Get the filenames #执行脚本的时候将脚本后跟的第一个文件定义为 cue 文件，第二个文件定义为 flac 文件。<br>cuefile=$1<br>flacfile=$2</p>
<p>#Other variables 通过 cueprint 抓取光盘曲目数。 -d 为读取 disc 模板，%N 为曲目数。<br>tracks=$(cueprint -d ‘%N’ “$cuefile”)</p>
<p>#Get the filenames into an array</p>
<p>#循环读取各个歌曲的信息。</p>
<p>#cueprint -n$count -t ‘%p - %T - %02n - %t’ “$cuefile” 中，-n 定义曲目号， -t 表示读取歌曲模板，%p 作者，%T 专辑名。</p>
<p>#%n 为歌曲编号，写为 %02n 则表示长度为2，即01、02。若%05n 则是显示为：00001。</p>
<p>#%t 为歌曲名。<br>count=1<br>while [ $count -le $tracks ]<br>do<br>tracknames[$count]=$(cueprint -n$count -t ‘%p - %T - %02n - %t’ “$cuefile”)     #Initialize the tracknames array and write a trackname in<br>count=<code>expr $count + 1</code>                                                         #Increment the counter<br>done</p>
<p>#Load up the ID3 tag info into variables for later use</p>
<p>#循环读取各个信息放入不同的变量。包括艺术家等。<br>id3count=1<br>while [ $id3count -le $tracks ]<br>do<br>artist[$id3count]=$(cueprint -n$id3count -t ‘%p’ “$cuefile”)<br>album[$id3count]=$(cueprint -n$id3count -t ‘%T’ “$cuefile”)<br>tracknum[$id3count]=$(cueprint -n$id3count -t ‘%02n’ “$cuefile”)<br>title[$id3count]=$(cueprint -n$id3count -t ‘%t’ “$cuefile”)<br>echo “Artist: ${artist[$id3count]}”<br>echo “Album: ${album[$id3count]}”<br>echo “Track No: ${tracknum[$id3count]}”<br>echo “Song Title: ${title[$id3count]}”<br>id3count=$[$id3count + 1]<br>done</p>
<p>#Output general file information<br>cueprint -d ‘%P - %T\n’ “$cuefile”<br>echo “Total number of tracks: “ $tracks</p>
<p>#Split this bitch<br>cuebreakpoints “$cuefile” | shntool split -t ‘%n’ -o wav “$flacfile”                      #outputs 01.wav 02.wav, etc</p>
<p>#Convert those waves into mp3s</p>
<p>#由于 输出为  wav 文件的时候，number 为 001、002等格式。所以下面补足一下。<br>convertcount=1<br>while [ $convertcount -le $tracks ]<br>do<br>if [ $convertcount -lt 10 ]                                                     #Got to pad with zeros<br>then<br>wavenum=0$convertcount<br>else<br>wavenum=$convertcount<br>fi</p>
<p>#通过 lame 将 wav 转换为 mp3，同时灌入tags。</p>
<p>#lame –noreplaygain -b 320 “$wavenum.wav” “${tracknames[$convertcount]}.mp3”   #Compress the file and give it the trackname in the array<br>lame –noreplaygain -b 320 –ta “${artist[$convertcount]}” –tl “${album[$convertcount]}” –tn “${tracknum[$convertcount]}” –tt “${title[$convertcount]}” “$wavenum.wav” “${tracknames[$convertcount]}.mp3”<br>rm ./“$wavenum.wav”                                                             #cleanup 删除临时的 wav 文件<br>convertcount=$[$convertcount + 1]</p>
<p>done</p>
</div></article></div></main><footer><div class="paginator"><a href="/2007/11/nightwish-dark-passion-play.html" class="prev">PREV</a><a href="/2007/11/decoder-ape-with-jmac.html" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://latteye.me">latteye</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>