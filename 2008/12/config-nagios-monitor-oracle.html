<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 配置 Nagios 监控 Oracle 服务器 · Water is</title><meta name="description" content="配置 Nagios 监控 Oracle 服务器 - latteye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://latteye.me/atom.xml" title="Water is"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">配置 Nagios 监控 Oracle 服务器</h1><div class="post-info">2008年12月3日</div><div class="post-content"><p>环境：Oracle 10g<br>CentOS 5.2 x86_64</p>
<p><strong>一、在 Oracle 所在服务器上安装 NRPE</strong></p>
<p>安装过程参考 Nagios NRPE 文档。<br><a id="more"></a><br>注意点：<br>    1.由于 nagios 脚本需要读取 oracle 相关文件。所以运行 nagios 的用户需要定义为 oracle 服务用户。并且修改 /etc/xinted.d/nrpe 中的配置。</p>
<p><code>service nrpe
{
        flags           = REUSE
        socket_type     = stream
        port            = 5666
        wait            = no
        user            = oracle
        group           = nagios
        server          = /usr/local/nagios/bin/nrpe
        server_args     = -c /usr/local/nagios/etc/nrpe.cfg --inetd
        log_on_failure  += USERID
        disable         = no
        only_from       = 192.168.100.62
}</code></p>
<pre><code>2.给 oracle 用户在 ORACLE_HOME 目录下执行权限。
`chmod –Rf 740 $ ORACLE_HOME/*`

3.修改 check_oracle 脚本。将 $ORACLE_HOME 以及 $PATH 手动加入，避免出现问题。
</code></pre><p><code>ORACLE_HOME=/u01/oracle/product/10.2.0/db_1
    PATH=$PATH: /u01/oracle/product/10.2.0/db_1/bin</code></p>
<p>二、    配置 nrpe 服务</p>
<p>修改 /usr/local/nagios/etc/nrpe.cfg 文件。加入以下内容：</p>
<p><code>#Check Oracle
command[check_oracle_tns]=/usr/local/nagios/libexec/check_oracle --tns orcl
command[check_oracle_db]=/usr/local/nagios/libexec/check_oracle --db orcl
command[check_oracle_login]=/usr/local/nagios/libexec/check_oracle --login orcl
command[check_oracle_cache]=/usr/local/nagios/libexec/check_oracle --cache orcl system lkjsdf 80 90
command[check_oracle_tablespace]=/usr/local/nagios/libexec/check_oracle --tablespace orcl system lkjsdf tab 90 80</code></p>
<p>具体参数写法请参考 check_oracle –help。</p>
<p>配置完成后，重启 xinetd 服务。</p>
<p><strong>三、配置 Nagios 服务端</strong></p>
<p>1.安装 nrpe 脚本支持。—参考官方文档。<br>2.添加 nrpe 命令配置。修改 nagios/etc/objects/command.cfg 文件：</p>
<p><code>define command {
        command_name check_nrpe
        command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$
}</code></p>
<p>3.在 nagios/etc/objects 添加oracle 主机配置文件。oracle.cfg 。</p>
<p>`define host {<br>        use             linux-server<br>        host_name       oracle<br>        alias           Oracle 10g<br>        address         192.168.100.63<br>        }</p>
<p>define service {<br>        use             generic-service<br>        host_name       oracle<br>        service_description     TNS Check<br>        check_command   check_nrpe!check_oracle_tns<br>        }<br>define service {<br>        use             generic-service<br>        host_name       oracle<br>        service_description     DB Check<br>        check_command   check_nrpe!check_oracle_db<br>        }<br>define service {<br>        use             generic-service<br>        host_name       oracle<br>        service_description     Login Check<br>        check_command   check_nrpe!check_oracle_login<br>        }<br>define service {<br>        use             generic-service<br>        host_name       oracle<br>        service_description     Cache Check<br>        check_command   check_nrpe!check_oracle_cache<br>        }<br>define service {<br>        use             generic-service<br>        host_name       oracle<br>        service_description     Tablespace Check<br>        check_command   check_nrpe!check_oracle_tablespace<br>        }`</p>
<p>效果图：</p>
<p><a href="http://latteye.com/wp-content/images/Nagios_1228211757147.png" target="_blank" rel="external"><img src="http://latteye.com/wp-content/images/_Nagios_1228211757147.png" alt=""></a></p>
<p>NRPE 以及 Nagios-Plugin 安装文件见附件包内。NRPE 官方文档也包含在附件包呢。</p>
<p><strong>备注：</strong><br>图中 Tablespace check 还没有细调，用了错误的 table 名。<br>通过修改脚本还可以监视临时表空间。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2008/12/bearaudio-begin.html" class="prev">PREV</a><a href="/2008/11/config-nagios-send-alarm-with-fetion.html" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://latteye.me">latteye</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>