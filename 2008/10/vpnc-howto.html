<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> VPNC 工具的使用 · Water is</title><meta name="description" content="VPNC 工具的使用 - latteye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://latteye.me/atom.xml" title="Water is"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/yuan-hao-yang" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">VPNC 工具的使用</h1><div class="post-info">2008年10月25日</div><div class="post-content"><p>上周朋友给了一个 Cisco VPN 工具。通过导入 pcf 配置文件，连接到公司VPN服务器。用起来非常方便。而且 Cisco VPN 路由定义的非常好，有需要的地方才加路由，不像 Windows PPTP 服务器–一刀切。</p>
<p>但是我大多数的工作时间都呆在了 Arch Linux 下。如何在 Linux 下实现呢？<a href="http://www.vpnc.org/" target="_blank" rel="external">VPNC</a> 可以做到。</p>
<a id="more"></a>
<p><strong>一、安装</strong></p>
<p><code>pacman -S vpnc</code></p>
<p><strong>二、配置</strong></p>
<p><strong>1. 配置文件结构</strong></p>
<p>vpnc 只读取一个配置文件，第一个读取的是 /etc/vpnc/default.conf ，当此文件不可用时 /etc/vpnc.conf 成为了第二选择。</p>
<p><strong>2. 配置文件内容</strong></p>
<p>其基本内容如下：</p>
<blockquote>
<p>IPSec gateway vpngateway.domain.org</p>
<p>IPSec ID group_id</p>
<p>IPSec secret group_password</p>
<p>Xauth username network_signon</p>
<p>Xauth password network_password</p>
</blockquote>
<p>可能还会带有类似内容：</p>
<blockquote>
<p>IKE Authmode psk</p>
<p>IKE DH Group dh2</p>
</blockquote>
<p>ipsec 的加密方式之前已经讨论过了，相信这些字段不陌生。</p>
<p>配置描述：<br>IPSec gateway  #VPN网关地址，可以是域名，可以是 IP。<br>IPSec ID  ＃取个名字<br>IPSec secret ＃交换密钥<br>Xauth username ＃登录用户名<br>Xauth password  ＃登录使用密码，如果配置文件不包含此字段，会在连接时请求输入。</p>
<p>3. PCF 文件的转换</p>
<p>Windows 环境下经常可以下载到 pcf 配置文件，vpnc 已经包含了 pcf2vpnc 工具。可以快速将 pcf 转换为 vpnc 配置文件。</p>
<p><code>pcf2vpnc pcffilename &gt; /etc/vpnc.conf</code></p>
<p><strong>三、 VPNC 连接</strong></p>
<p><strong>1. 模块加载</strong></p>
<p>确定 tun 模块是否加载：</p>
<p><code>lsmod | grep tun</code></p>
<p>加载 tun 模块：</p>
<p><code>modprobe tun</code></p>
<p>查看 TUN 模块加载 dmesg 信息：</p>
<p><code>dmesg | grep TUN
tun: Universal TUN/TAP device driver, 1.6</code></p>
<p>当然，在这之前，你要确定 TUN 被编译成了模块，或者已经编译进了内核中：</p>
<blockquote>
<p>Device Drivers  —&gt;</p>
<p>  Networking support  —&gt;</p>
<pre><code>[*] Universal TUN/TAP device driver support
</code></pre></blockquote>
<p><strong>2. 建立链接</strong></p>
<p><code>sudo vpnc</code></p>
<p>建立此链接需要 root 权限。</p>
<p>3.断开链接</p>
<p><code>sudo vpnc-disconnect</code></p>
<p><strong>四、查看链接信息</strong></p>
<p><strong>1. tun 设备</strong></p>
<p><code>#ip add show</code></p>
<p>6: tun0: <pointopoint,multicast,noarp,up,lower_up> mtu 1412 qdisc pfifo_fast state UNKNOWN qlen 500<br>    link/[65534]<br>    inet 1.1.1.30/32 scope global tun0</pointopoint,multicast,noarp,up,lower_up></p>
<p><strong>2. 路由信息</strong></p>
<p><code>#ip route show</code></p>
<blockquote>
<p>63.149.188.150 via 172.16.5.1 dev eth0  src 172.16.5.2  mtu 1500 advmss 1460</p>
<p>172.16.21.10 dev tun0  scope link </p>
<p>172.16.21.11 dev tun0  scope link </p>
<p>192.168.6.0/24 dev tun0  scope link </p>
<p>1.1.75.0/24 dev tun0  scope link </p>
<p>172.16.5.0/24 dev eth0  proto kernel  scope link  src 172.16.5.2 </p>
<p>192.168.3.0/24 dev tun0  scope link </p>
<p>192.168.50.0/24 dev tun0  scope link </p>
<p>172.16.150.0/24 dev vmnet8  proto kernel  scope link  src 172.16.150.1 </p>
<p>192.168.2.0/24 dev tun0  scope link </p>
<p>172.16.0.0/24 dev tun0  scope link </p>
<p>192.168.15.0/24 dev tun0  scope link </p>
<p>192.168.12.0/24 dev tun0  scope link </p>
<p>192.168.27.0/24 dev vmnet1  proto kernel  scope link  src 192.168.27.1 </p>
<p>10.80.0.0/16 dev tun0  scope link </p>
<p>10.2.0.0/16 dev tun0  scope link </p>
<p>10.3.0.0/16 dev tun0  scope link </p>
<p>172.24.0.0/16 dev tun0  scope link </p>
<p>10.16.0.0/16 dev tun0  scope link </p>
<p>10.32.0.0/16 dev tun0  scope link </p>
<p>10.55.0.0/16 dev tun0  scope link </p>
<p>10.101.0.0/16 dev tun0  scope link </p>
<p>10.6.0.0/16 dev tun0  scope link </p>
<p>172.30.0.0/16 dev tun0  scope link </p>
<p>10.100.0.0/16 dev tun0  scope link </p>
<p>10.102.0.0/16 dev tun0  scope link </p>
<p>172.18.0.0/16 dev tun0  scope link </p>
<p>172.19.0.0/16 dev tun0  scope link </p>
<p>172.16.0.0/16 dev tun0  scope link </p>
<p>172.17.0.0/16 dev tun0  scope link </p>
<p>172.22.0.0/16 dev tun0  scope link </p>
<p>172.20.0.0/16 dev tun0  scope link </p>
<p>172.21.0.0/16 dev tun0  scope link </p>
<p>default via 172.16.5.1 dev eth0</p>
</blockquote>
<p>其他 unix 可以用 netstat -r 查看。话说我还是很佩服 Linux 的高级路由的。<br>可以清楚的看到，只有特定路由被定义到了 tun 设备上。</p>
<p>好了，基本的功能就介绍到这里。其他高级功能，比如按需自动拨号之类，网上搜搜也能搜到很多了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2008/10/apache-security-config.html" class="prev">PREV</a><a href="/2008/10/jboss-cluster-e9-85-8d-e7-bd-ae-e5-b0-8f-e7-bb-93.html" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://latteye.me">latteye</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>