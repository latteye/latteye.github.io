<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 打破Debian神话之一：urpmi系列工具 · Water is</title><meta name="description" content="打破Debian神话之一：urpmi系列工具 - latteye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://latteye.me/atom.xml" title="Water is"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/yuan-hao-yang" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">打破Debian神话之一：urpmi系列工具</h1><div class="post-info">2006年11月23日</div><div class="post-content"><p>经过linuxfans朋友指点 知道了urpmi这个东西 学习一下</p>
<p>注意<br>本文只适合Mandrakelinux用户，请Redhat/Fedora、SUSE、Turbolinux等用户走开。尤其欢迎Debian用户前来批评指正(仅限技术方面)。<br><a id="more"></a></p>
<p>前言<br>本文写作的目的，并不是想要将Debian用户争取到Mandrakelinux阵营来，更不是贬低Debian的技术含量。作为一个社区维护的项目， Debian为Linux的发展做出了很大的贡献。我只是希望让大家知道，Mandrakelinux作为一个商业与社区并重的发行版，有着自己的技术特色和优势。某些人混淆视听，说出的一些话让我十分不满，这也是我起这个标题的原因。</p>
<h1 id="1-urpmi是什么东西"><a href="#1-urpmi是什么东西" class="headerlink" title="1.urpmi是什么东西"></a>1.urpmi是什么东西</h1><p>准确的说，urpmi是一组以urpm开头的命令。它的作用是来取代Redhat发明的rpm命令。rpm是一项伟大的发明，但它所带来的依赖性问题解决起来总是十分的困难。所以，各种各样的rpm辅助工具就开发出来了，urpmi系列就是其中的一种。它不但可以帮你解决依赖性问题，还提供了更多的功能，诸如安装介质管理。</p>
<h1 id="2-urpmi系列有哪些命令"><a href="#2-urpmi系列有哪些命令" class="headerlink" title="2.urpmi系列有哪些命令"></a>2.urpmi系列有哪些命令</h1><p>这个问题似乎很好解决。你在控制台下输入urpm然后按两次tab键就可以看到了。注意，非特权用户只开放了urpmf和urpmq两个命令，而root可以使用包括urpmi、urpme在内的全部命令。</p>
<p>我在本文中会主要介绍urpmi命令的使用，其它命令的功能会在后面简单提一下，更详细的大家可以看man或者help。</p>
<h1 id="3-起点：urpmi-–help"><a href="#3-起点：urpmi-–help" class="headerlink" title="3.起点：urpmi –help"></a>3.起点：urpmi –help</h1><p>我们会看到类似于如下的输出：<br>代码:<br>urpmi 版本 4.5<br>版权 © 1999-2004 Mandrakesoft。<br>这是自由软件，可以依照 GNU GPL 重新发布。</p>
<p>用法:<br>–help - 打印帮助信息。<br>–update - 只使用升级介质。<br>–media - 只使用列出的介质，介质之间用逗号分隔。<br>–excludemedia - 不使用给定介质，介质之间用逗号分隔。<br>–sortmedia - 根据用逗号分隔的子字符串排序介质。<br>–synthesis - 使用指定的综合文件而不是 urpmi db。<br>–auto - 自动选中软件包。<br>–auto-select - 自动选择升级系统的软件包。<br>–no-uninstall - 从不询问卸载软件包，直接中断安装。<br>–keep - 如果有可能就保留已有软件包，拒绝导致删除的软件包。<br>–split-level - 如果将要安装或升级的软件包多于给定的软件包，就拆分为<br>较小的交易。默认为 20。<br>–split-length - 小交易长度，默认为 1。<br>–fu - 利用模糊查询(和 -y 一样)。<br>–src - 下一个软件包是源程序包(和 -s 一样)。<br>–install-src - 只安装源代码包(无二进制文件)。<br>–clean - 首先删除缓存中的rpm。<br>–noclean - 保留缓存中没有使用的rpm。<br>–force - 强制执行, 即使某些软件包并不存在。<br>–allow-nodeps - 允许要求用户不经过依赖性检验<br>就安装软件包。<br>–allow-force - 允许提示用户安装软件包而不<br>检查依赖性和完整性。<br>–parallel - 在多个机器上分布的运行 urpmi。<br>–root - 使用另一个 root 安装 rpm。<br>–use-distrib - 配置 urpmi 实时从发行树中抓取，特别用于在 –root 选项<br>下安装 chroot。<br>–wget - 用 wget 取远程文件。<br>–curl - 用 crul 取远程文件。<br>–limit-rate - 降低下载速度。<br>–resume - 续传未下载完成的文件<br>(–no-resume 禁用它，默认是禁用的)。<br>–proxy - 使用指定的 HTTP 代理，默认的端口号是<br>1080(格式如 )。<br>–proxy-user - 指定用于代理认证的用户和<br>口令(格式如 &lt;用户: 口令&gt;)。<br>–bug - 输出故障报告<br>下一个参数指定输出目录。<br>–env - 使用指定的环境(特别是进行故障报告时)。<br>–X - 使用 X 界面。<br>–best-output - 根据运行环境选择最好的界面:<br>X 或文本模式。<br>–verify-rpm - 安装之前验证 rpm 签署。<br>(–no-verify-rpm 禁止它，默认是激活的)。<br>–test - 验证安装是否可以正确进行。<br>–excludepath - 排除按逗号分隔的路径。<br>–excludedocs - 排除文档文件。<br>–skip - 安装要跳过的软件包。<br>–more-choices - 如果找到了多个软件包，则提供多个选择而不是默认选择。<br>-a - 在命令行选择所有匹配。<br>-p - 允许在提供的项目中寻找软件包。<br>-P - 不搜索提供标签中的软件包。<br>-y - 利用模糊查询(和 –fu 一样)。<br>-s - 下一个软件包是源程序包(和 –src 一样)。<br>-q - 安静模式。<br>-v - 详细的提示。</p>
<p>命令行给出的软件包名或 rpm 文件将会被安装。<br>当然，我们不会在每条命令都用到urpmi的全部选项。</p>
<h1 id="4-最简单的一个例子"><a href="#4-最简单的一个例子" class="headerlink" title="4.最简单的一个例子"></a>4.最简单的一个例子</h1><p>我已经先行在这篇帖子里用到urpmi命令了，注意看里边的第四步。所以，urpmi比较简单的通用格式就是urpmi file.rpm。</p>
<p>那么请各位看官记住了，在Mandrakelinux下安装软件，用的命令不是 rpm -i，而是urpmi。</p>
<h1 id="5-让人吃惊的一幕"><a href="#5-让人吃惊的一幕" class="headerlink" title="5.让人吃惊的一幕"></a>5.让人吃惊的一幕</h1><p>你也许会注意到，10.1 Official的默认情况下没有为我们安装xmms，而是选择了amaroK作为默认的音乐播放器。如果你想要再用到xmms，应该怎么办呢？</p>
<p>比较笨的人一般会从rpmfind.net上搜索xmms+mdk。稍微聪明一点的人会知道把Disc1的ISO挂上来，找到xmms.rpm，然后用上面刚学到的urpmi命令来安装。哪有那么麻烦？直接输入urpmi xmms不就行了？看看多省事！不相信？你可以再用kget做个例子，这也是个系统自带的软件。</p>
<p>在执行urpmi xmms和urpmi kget的时候，系统会问你：<br>代码:<br>为了满足依赖性，需要安装以下软件包：<br>xxx.rpm,yyy.rpm</p>
<p>你有的选择吗？你只能选择“是”。如果你觉得每次都选“是”不太方便，那么就需要使用一个特殊的参数。从上面的参数列表里好好找找，我相信你一定能一眼就看见–auto这个参数。</p>
<h1 id="6-其它的命令"><a href="#6-其它的命令" class="headerlink" title="6.其它的命令"></a>6.其它的命令</h1><p>我并不打算在这里为每个选项各举例子，况且我对其中某些选项也不是十分清楚</p>
<p>与安装软件类似的，urpme用来删除软件，urpmf用来查找文件，urpmq是用来查询软件的包。这个和rpm命令都差不多。</p>
<p>比如，如果你要装一个软件，人家需要一个库libxxx.so.4，但你不知道这个库在哪个包里，可以使用urpmf libxxx.so.4来查询。</p>
<p>又如，你想知道现在系统自带的gcc版本是多少，可以用urpmq -f gcc来查询。如果碰巧系统没有自动安装gcc的话，你该怎么安装呢？对了，urpmi gcc。</p>
<h1 id="7-来做个例子吧"><a href="#7-来做个例子吧" class="headerlink" title="7.来做个例子吧"></a>7.来做个例子吧</h1><p>比如我们现在要来安装webmin这个系统维护工具。我们不太确定Mandrakelinux在光盘上是否为我们提供了这个东西，所以我们现用urpmq来查询一下<br>代码:<br>urpmq webmin</p>
<p>看起来很不错，我们找到了。但webmin需要哪些依赖性要求呢？<br>代码:</p>
<h1 id="urpmq-d-webmin"><a href="#urpmq-d-webmin" class="headerlink" title="urpmq -d webmin"></a>urpmq -d webmin</h1><p>SysVinit<br>bash<br>bootloader-utils<br>bzip2<br>chkconfig<br>coreutils<br>cpio<br>cracklib-dicts<br>diffutils<br>drakxtools-backend<br>e2fsprogs<br>elfutils<br>findutils<br>gawk<br>gettext-base<br>glibc<br>grep<br>ifplugd<br>info-install<br>initscripts<br>iproute2<br>iputils<br>ldconfig<br>ldetect-lst<br>libbeecrypt6<br>libbzip2_1<br>libcrack2<br>libdb4.2<br>libelfutils1<br>libext2fs2<br>libgdbm2<br>libglib1.2<br>libgpm1<br>libintl3<br>libncurses5<br>libopenssl0.9.7<br>libpam0<br>libpcre0<br>libpwdb0<br>libselinux1<br>libslang1<br>libtermcap2<br>lsof<br>make<br>mingetty<br>mktemp<br>modutils<br>mount<br>ncurses<br>openssl<br>pam<br>perl<br>perl-Authen-PAM<br>perl-CGI<br>perl-MDK-Common<br>perl-Net_SSLeay<br>perl-base<br>popt<br>procps<br>psmisc<br>pwdb-conf<br>rpm<br>rpm-helper<br>sash<br>sed<br>setup<br>shadow-utils<br>sound-scripts<br>tar&#124;rmt<br>unzip<br>util-linux<br>webmin<br>which<br>zlib1<br>看起来还不少的样子。没关系，我们直接来安装好了，系统会提示你依次插入相应的光盘。<br>代码:</p>
<h1 id="urpmi-webmin"><a href="#urpmi-webmin" class="headerlink" title="urpmi webmin"></a>urpmi webmin</h1><p>为了满足依赖性要求，将另外安装以下5个软件包(25 MB):<br>lsof-4.71-1mdk.i586<br>perl-Authen-PAM-0.14-4mdk.i586<br>perl-CGI-3.05-1mdk.noarch<br>perl-Net_SSLeay-1.25-3mdk.i586<br>webmin-1.150-3.1.101mdk.noarch<br>这样好了吗?(是(Y)/否(n))[是]<br>呀，不小心按了一下No！算了，还是用auto比较省事：<br>代码:<br>urpmi –auto webmin</p>
<p>打破Debian神话之二：丰富的urpm软件仓库</p>
<p>本文是《打破Debian神话》系列文章的第二篇。本人再次声明，这一系列文章之所以起名叫作“打破Debian神话”，无意引起Debian和 Mandrakelinux孰优孰劣的讨论。我只是一个Mandrakelinux的老用户，想要澄清一些事情，也希望那些Debianer的眼界放得开一些。</p>
<h1 id="1-最为关键的网址"><a href="#1-最为关键的网址" class="headerlink" title="1. 最为关键的网址"></a>1. 最为关键的网址</h1><p><a href="http://easyurpmi.zarb.org/" target="_blank" rel="external">http://easyurpmi.zarb.org/</a><br><a href="http://www.urpmi-addmedia.org/" target="_blank" rel="external">http://www.urpmi-addmedia.org/</a></p>
<p>这两个网站的内容是基本相同的。本文的所有练习可能都要通过这两个网站来完成。建议你将这两个网址加入书签以便收藏。</p>
<h1 id="2-Mandrakelinux的软件仓库-介质源-简介"><a href="#2-Mandrakelinux的软件仓库-介质源-简介" class="headerlink" title="2. Mandrakelinux的软件仓库(介质源)简介"></a>2. Mandrakelinux的软件仓库(介质源)简介</h1><p>所谓介质源(media source)，是指这样一个软件仓库，该软件仓库中存放了大量专为某个发行版所制作的软件包，并通过一定的索引形式对软件包进行管理。这样的介质源，在Debian和Redhat/Fedora Core中的含义是差不多的。</p>
<p>在Mandrakelinux 中，介质源可以是多种形式，既可以来自本机的硬盘、光盘，也可以来自局域网的共享文件夹，当然也可以由互联网上的FTP或http服务器所提供。这里我们着重介绍从互联网上获得你所需要的软件包。而介质源的索引，称为hdlist或者是综合文件。hdlist和综合文件两者的功能是一样的，只不过 hdlist多出了每个软件包的ChangeLog以及文件清单，所以会大很多。所以，假如你使用的是综合文件作为索引，因为其中没有每个包的文件清单， urpmf libxxx.so.4是查不出来的。</p>
<p>介质源的格式一般为：<br>代码:<br>&lt;名称&gt; with</p>
<p>我来举个例子可能会比较容易懂一点：<br>代码:<br>main <a href="http://gd.tuwien.ac.at/pub/linux/Mandrakel...i586/media/main" target="_blank" rel="external">http://gd.tuwien.ac.at/pub/linux/Mandrakel...i586/media/main</a> with media_info/synthesis.hdlist.cz<br>上面这句话代表了这样的一个介质源，它的名字叫做main，所有的RPM包都放在指定的目录中，而使用的综合文件是<a href="http://gd...../media/main/media_info/synthesis.hdlist.cz。" target="_blank" rel="external">http://gd...../media/main/media_info/synthesis.hdlist.cz。</a></p>
<h1 id="3-Mandrakelinux-镜像服务器的结构"><a href="#3-Mandrakelinux-镜像服务器的结构" class="headerlink" title="3. Mandrakelinux 镜像服务器的结构"></a>3. Mandrakelinux 镜像服务器的结构</h1><p>Mandrakelinux 镜像服务器一般是分成devel和official两个目录。devel中存放了开发中版本，包括cooker和community，而official中存放了正式版本。现在以official/10.1为例，介绍一下每个目录的作用。</p>
<p>代码:<br>devel/<br>official/<br>10.0/<br>10.1/<br>SRPM/<br>amd64/<br>i586/<br>media/<br>main/<br>media_info/<br>contrib/<br>media_info/<br>j_package/<br>media_info/<br>updates/<br>10.0/<br>10.1/<br>media_info/</p>
<p>大家请注意看红色的目录。可以知道，Mandrakelinux每个版本的软件仓库分别存放在main，contrib，j_package里边。而每个目录都有自己的media_info子目录，用来存放hdlist和综合文件。</p>
<p>main就是我们在光盘的ISO中看到的那些东西。<br>contrib 里边会存放另外一些软件，比如mozilla-firefox，abiword，php5等等，这里边的软件很可能以后会被移动到main里边，从而成为光盘的一部分(比如前两天，bash3刚刚从contrib移到main里)。但这并不说明contrib里边的东西不稳定或者不完善。实际上，在打包者眼里，contrib和main只是两个不同的仓库。只有在制作光盘的时候，main和contrib才会分得比较清楚。<br>j_package里边是一些需要java才能运行的程序。也许以后lumaqq会被放到里边。<br>official/updates里边主要是一些安全更新和漏洞修补。</p>
<p>就目前而言，main、contrib、j_package每个目录的容量都超过3G。这意味着，你所听到或者看到的几乎所有软件，都可以在这三个目录中找到现成的rpm包，你用不着自己编译。</p>
<h1 id="4-一个简单的例子"><a href="#4-一个简单的例子" class="headerlink" title="4. 一个简单的例子"></a>4. 一个简单的例子</h1><p>现在我们来盘算一下，四张光盘的10.1 Official，大概有多少内容。第一张盘上有一大坨安装程序，第二张盘上有一小坨2.4内核，第四张盘上还有一个根本没法用的KDE 3.3。所以，这四张盘中，实际的rpm库容量，很可能不会超过2.4G。</p>
<p>而我前面已经说过了，只有main里的东西才会被用来制作光盘的。显然，这四张光盘根本装不下main里的所有东西。一个比较直观的例子就是zhcon、星际译王的字典都被砍掉了。现在，我们来做个实验，把main里被砍掉的东西都找回来。</p>
<p>到上面说的那两个网址去，你会看到这个界面十分的容易使用。第一步就是选择系统的版本，默认就是10.1 i586。第二步是选择所需要的软件仓库，这里我们只选择一个main就好了。在前进到第三步之前，请注意看一下第二步的最后一个选项，是一个复选框 “<strong><em>compress</em></strong>”什么。这个选项是用来选择使用哪种索引文件：如果不勾上，使用的就是带有N长changelog的hdlist；如果勾上，使用的就是体积较小的综合文件。我反正觉得changelog一般没什么用，所以每次都是把这个选项勾上的。</p>
<p>第三步的时候，你会得到一个类似这样的命令：<br>代码:<br>urpmi.addmedia main <a href="http://gd.tuwien.ac.at/pub/linux/Mandrakel...i586/media/main" target="_blank" rel="external">http://gd.tuwien.ac.at/pub/linux/Mandrakel...i586/media/main</a> with media_info/synthesis.hdlist.cz</p>
<p>以root身份执行这条命令，你会看到系统在一步一步地添加main这个介质。</p>
<p>介质添加完成以后呢？我们来试一下吧：<br>代码:<br>urpmi zhcon</p>
<p>如何？zhcon是不是马上就安装上了。</p>
<h1 id="5-更为复杂的应用"><a href="#5-更为复杂的应用" class="headerlink" title="5. 更为复杂的应用"></a>5. 更为复杂的应用</h1><p>在上面的例子中，我们使用urpmi.addmedia命令添加了main这个介质源。当然，我们也可以把contrib、j_package都添加进来。这完全取决于个人喜好了。</p>
<p>你可能还听说过plf这种介质源。这里边基本上都是包含潜在版权或法律问题的软件。比如DVDrip这样的功能。如果你觉得没关系的话，也可以一并加进来。</p>
<p>urpm 的会把hdlist或综合文件下载到本地硬盘上再进行分析。这样会导致一个问题：如果本地的综合文件比较旧，而远程的RPM介质源比较新，就会造成RPM 文件搜索失败。要更新本地的hdlist或综合文件，我们要使用的命令是 urpmi.update &lt;介质源名称&gt;。你也可以用 urpmi.update -a 来更新全部介质源。</p>
<p>此外，你也可以将cooker添加为介质。cooker是一个开发中版本，每天更新极快。如果你决意使用cooker，只需将下面两条命令添加到crontab里(前提是你必须已经添加了cooker介质源)：<br>代码:<br>urpmi.update -a<br>urpmi –auto –auto-select</p>
<p>第一条命令是更新所有的介质源，第二条命令是更新系统中现有的所有rpm软件包。这样你就可以随时使用到最新版本的软件包。不过，既然是开发中版本，没人能保证它的稳定性。</p>
<p>结束。</p>
<h1 id="附注："><a href="#附注：" class="headerlink" title="附注："></a>附注：</h1><p>在论坛里看到很多人都在问Mandriva Linux中怎么更换输入法，因为默认的输入法SCIM与Realplayer和Adobe Reader冲突，导致它们不能正常启动。有人从网上下载输入法的安装文件然后自己安装，然而装上以后会碰到修改配置文件来使新装的输入法生效的问题。<br>其实，看了上面的文章之后，解决输入法问题也就易如反掌了。<br>方法：<br>1.按照上文中提到的方法配置好介质源。<br>2.用su -命令获得root权限，运行如下命令：<br>localedrake<br>然后按照提示选择国家和地区，然后是输入法，这时我们可以直接选择自己想用的输入法，例如fcitx，选好后点确定，系统就会自动从上面配置的介质源中安装fcitx了，并且自动配置好了输入法启动文件，然后重启X服务器，是不是已经成功了？</p>
</div></article></div></main><footer><div class="paginator"><a href="/2006/11/e5-a4-a7-e5-ad-a6-e5-9b-9b-e5-b9-b4-e7-9a-84-e5-bf-83-e5-be-97.html" class="prev">PREV</a><a href="/2006/11/e7-94-9f-e6-b4-bb-e3-80-81-e8-89-ba-e6-9c-af-e3-80-81-e5-88-9b-e9-80-a0.html" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://latteye.me">latteye</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>